# Product Requirements Document: Rich Text Migration and CMSLink Integration

## 1. Introduction/Overview

This document outlines the requirements for migrating our frontend from rendering HTML content generated by Payload's Lexical editor to using the `RichText` component. This change allows for more robust and customizable rendering of rich text content. As part of this migration, we will replace the default link renderer with our existing `CMSLink` component to ensure a consistent link style and behavior across the application.

The primary goal is to improve maintainability and unlock the ability to create custom renderers for different nodes within the rich text content, starting with links.

## 2. Goals

*   Replace all instances of `dangerouslySetInnerHTML` or direct HTML rendering of `content_html` from Payload with the `<RichText />` component.
*   Integrate the custom `CMSLink` component to render all links within the rich text content.
*   Ensure all existing link attributes from the CMS (URL, `newTab`) are correctly mapped to the `CMSLink` component's props.
*   Remove the now-obsolete `enhanceFirstLetterInContent` functionality and its usages.
*   Fix any resulting type errors, such as the one in `src/app/(app)/[domain]/ogloszenia/[date]/(with-layout)/page.tsx`.

## 3. User Stories

*   As a developer, I want to use a structured `RichText` component instead of raw HTML so that I can easily customize the rendering of different content elements (like links, images, etc.).
*   As a content editor, I want the links I create in the CMS to render on the website with the same style and behavior as other links on the page.
*   As an end-user, I expect all links within the content to be visually consistent and functional, opening in a new tab when specified by the content editor.

## 4. Functional Requirements

1.  Identify all components in the codebase that currently render `content_html` from a Payload Page or other collection.
2.  In each identified component, replace the HTML rendering logic with the `<RichText />` component from `@payloadcms/richtext-lexical/react`.
3.  The `data` prop of the `RichText` component should be bound to the `content` field (JSON format) from the Payload collection, not `content_html`.
4.  Create a custom link element serializer for the `RichText` component.
5.  This serializer must use the `CMSLink` component for rendering.
6.  The serializer must extract the following fields from the Lexical link node data:
    *   `doc` (for internal links)
    *   `url` (for external links)
    *   `newTab`
7.  These fields must be correctly mapped to the corresponding props of the `CMSLink` component (`reference`, `url`, `newTab`).
8.  The `enhanceFirstLetterInContent` function and any associated styles or logic must be removed from the codebase.
9.  The linter error in `src/app/(app)/[domain]/ogloszenia/[date]/(with-layout)/page.tsx` related to the `data` prop of `RichText` must be resolved by ensuring `page.content` is correctly passed and handled when it might be `null` or `undefined`.
10. The `(print)` page at `src/app/(app)/[domain]/ogloszenia/[date]/(print)/print/page.tsx` must also be updated to use the `RichText` component, and its print-specific styling should be preserved as much as possible.

## 5. Non-Goals (Out of Scope)

*   Creating custom renderers for any elements other than links.
*   Changing the appearance or functionality of the `CMSLink` component itself.
*   Migrating any other part of the application that does not use the Lexical rich text editor from Payload.
*   Replicating the "enhanced first letter" functionality. This feature will be deprecated.

## 6. Design Considerations

The rendered links should adopt the exact styling and behavior already defined in the `CMSLink` component, ensuring visual consistency with other links across the site. No new design is required.

## 7. Technical Considerations

*   The primary dependency is `@payloadcms/richtext-lexical/react`.
*   The `content` field from Payload collections contains the JSON data for the `RichText` component, while `content_html` will no longer be used.
*   We will need to create a new component, likely `RichText/serialize.tsx` or similar, to house the custom serializers.
*   The solution must be robust enough to handle cases where `page.content` might be empty, null, or undefined.

## 8. Success Metrics

*   All rich text content across the site is rendered using the `RichText` component.
*   All links within rich text content are rendered using the `CMSLink` component.
*   The `enhanceFirstLetterInContent` function is completely removed from the codebase.
*   There are no new linting errors or build failures.
*   The application functions correctly, with all pages rendering content and links as expected.

## 9. Open Questions

None at this time.
